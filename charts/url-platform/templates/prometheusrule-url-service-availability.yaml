{{- if .Values.monitoring.prometheusRules.availability.enabled }}
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: {{ include "url-platform.fullname" . }}-url-service-availability
  namespace: {{ .Release.Namespace }}
  labels:
    {{- with .Values.monitoring.prometheusRules.labels }}
    {{- toYaml . | nindent 4 }}
    {{- end }}
spec:
  groups:
    - name: url-service.availability
      rules:
        - alert: UrlServiceDown
          expr: |
            max by (namespace, service) (
              up{namespace="{{ .Release.Namespace }}", service="url-service"} == 0
            )
          for: 2m
          labels:
            severity: warning
            service: url-service
            env: {{ .Values.global.appEnv | default "unknown" | quote }}
          annotations:
            summary: "url-service is down (not being scraped)"
            description: "Prometheus cannot scrape url-service in namespace {{ .Release.Namespace }} for more than 2 minutes."
{{- end }}
